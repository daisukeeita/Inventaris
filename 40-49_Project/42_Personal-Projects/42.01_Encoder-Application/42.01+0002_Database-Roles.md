---
id: 42.01+0002 Database Roles
aliases: []
tags: []
---

# Database Role for PMVIC System

The PMVIC system uses role-based access control at **two-levels**:

1. **Database Level** -> Generic, Coarse-Grained access for application.
2. **Application Level** -> Business-specific roles like encoder, technician,
   accountant.

## Role Overview

|       **Roles**       | **Permissions**                                                                                                                                                              | **Use-Case**                                                                   |
| :-------------------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------- |
| `pmvic_app_readonly`  | - `SELECT` only (tables + views) <br> - No `INSERT`, `UPDATE`, `DELETE`                                                                                                      | For generating daily/weekly/monthly/yearly reports.                            |
| `pmvic_app_readwrite` | - `SELECT`, `INSERT`, `UPDATE`, `DELETE` on core tables <br> - Cannot modify schema                                                                                          | For regular application users to perform everyday day-to-day operations.       |
|   `pmvic_app_admin`   | - All privileges on `pmvic_db` schema (DDL + DML) but not cluster superuser <br> - Can create/alter tables, indexes, functions <br> - Cannot manage PostgreSQL cluste itself | For DB administrators responsible for schema evolution and performance tuning. |

> [!NOTE]
> We avoid using the PostgreSQL `superuser` role for this application to
> enforce least privilege.
> Only the `encoder_app_admin` has schema-level authority, scoped only to this database.

## Role Creation in PostgreSQL

```sql
-- Create roles
CREATE ROLE pmvic_app_readonly NOLOGIN;
CREATE ROLE pmvic_app_rw NOLOGIN;
CREATE ROLE pmvic_app_admin NOLOGIN;

-- Permissions
-- Readonly
GRANT CONNECT ON DATABASE pmvic_db TO pmvic_app_readonly;
GRANT USAGE ON SCHEMA public TO pmvic_app_readonly;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO pmvic_app_readonly;

-- Read/Write
GRANT pmvic_app_readonly TO pmvic_app_rw;
GRANT INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO pmvic_app_rw;

-- Admin
GRANT ALL PRIVILEGES ON DATABASE pmvic_db TO pmvic_app_admin;
GRANT ALL PRIVILEGES ON SCHEMA public TO pmvic_app_admin;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO pmvic_app_admin;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO pmvic_app_admin;
```
